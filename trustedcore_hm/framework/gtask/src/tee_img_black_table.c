/*
 * Copyright (c) Huawei Technologies Co., Ltd. 2022-2022. All rights reserved.
 * Description: test ta load blacklist
 * Create: 2022-02-26
 */
#include "tee_img_black_table.h"

#include <tee_log.h>
#include "tee_mem_mgmt_api.h"

#ifndef DEF_ENG
static const TEE_UUID g_ta_blacklist[] = {
    { 0x01010101, 0x0101, 0x0101, { 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01 } },
    { 0x01234567, 0x89ab, 0xcde0, { 0x12, 0x34, 0x56, 0x78, 0x9a, 0xbc, 0xde, 0x01 } },
    { 0x01234567, 0x89ab, 0xcde0, { 0x12, 0x34, 0x56, 0x78, 0x9a, 0xbc, 0xde, 0x02 } },
    { 0x01234567, 0x89ab, 0xcde0, { 0x12, 0x34, 0x56, 0x78, 0x9a, 0xbc, 0xde, 0x03 } },
    { 0x01234567, 0x89ab, 0xcde0, { 0x12, 0x34, 0x56, 0x78, 0x9a, 0xbc, 0xde, 0x04 } },
    { 0x03030303, 0x0303, 0x0303, { 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03 } },
    { 0x04040404, 0x9789, 0x4a7a, { 0xa2, 0xbe, 0xb6, 0x01, 0x55, 0xee, 0xf5, 0xf3 } },
    { 0x12121212, 0x1212, 0x1212, { 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12 } },
    { 0x19b39980, 0x2487, 0x7b84, { 0xf4, 0x1a, 0xbc, 0x89, 0x22, 0x62, 0xbb, 0x3d } },
    { 0x534d4152, 0x542d, 0x4353, { 0x4c, 0x54, 0x2d, 0x54, 0x41, 0x2d, 0x30, 0x01 } },
    { 0x534d4152, 0x542d, 0x4353, { 0x4c, 0x54, 0x2d, 0x54, 0x41, 0x2d, 0x30, 0x31 } },
    { 0x534d4152, 0x542d, 0x4353, { 0x4c, 0x54, 0x2d, 0x54, 0x41, 0x2d, 0x30, 0x32 } },
    { 0x534d4152, 0x542d, 0x4353, { 0x4c, 0x54, 0x2d, 0x54, 0x41, 0x2d, 0x53, 0x54 } },
    { 0x534d4152, 0x542d, 0x4353, { 0x4c, 0x54, 0x2d, 0x54, 0x41, 0x2d, 0x53, 0x55 } },
    { 0x534d4152, 0x542d, 0x4353, { 0x4c, 0x54, 0x2d, 0x54, 0x41, 0x2d, 0x53, 0x56 } },
    { 0x534d4152, 0x5443, 0x4c53, { 0x41, 0x52, 0x49, 0x54, 0x48, 0x4d, 0x45, 0x54 } },
    { 0x534d4152, 0x5443, 0x534c, { 0x53, 0x47, 0x4c, 0x49, 0x4e, 0x53, 0x54, 0x43 } },
    { 0x534d4152, 0x5443, 0x534c, { 0x54, 0x41, 0x54, 0x43, 0x46, 0x49, 0x43, 0x41 } },
    { 0x534d4152, 0x5443, 0x534c, { 0x54, 0x43, 0x52, 0x59, 0x50, 0x54, 0x4f, 0x31 } },
    { 0x534d4152, 0x5443, 0x534c, { 0x54, 0x43, 0x52, 0x59, 0x50, 0x54, 0x4f, 0x32 } },
    { 0x534d4152, 0x5443, 0x534c, { 0x54, 0x44, 0x41, 0x54, 0x41, 0x53, 0x54, 0x31 } },
    { 0x534d4152, 0x5443, 0x534c, { 0x54, 0x45, 0x52, 0x52, 0x54, 0x4f, 0x4f, 0x53 } },
    { 0x535129cd, 0x41fa, 0x4b53, { 0x97, 0x97, 0x5c, 0xcb, 0x20, 0x2a, 0x00, 0x16 } },
    { 0x79b12345, 0x9790, 0x4b7b, { 0xb2, 0xcf, 0xc6, 0x02, 0x44, 0xdd, 0xe5, 0xe3 } },
    { 0x79b77788, 0x9789, 0x4a7a, { 0xa2, 0xbe, 0xb6, 0x01, 0x55, 0xee, 0xf5, 0xf3 } },
    { 0x79b77789, 0x9710, 0x4a7b, { 0xa3, 0xbf, 0xb7, 0x02, 0x56, 0xef, 0xf6, 0xf4 } },
    { 0x7f313b2a, 0x68b9, 0x4e92, { 0xac, 0xf9, 0x13, 0x3e, 0xbb, 0x54, 0xeb, 0x56 } },
    { 0xabc12345, 0x1234, 0x1234, { 0x12, 0x34, 0x12, 0x34, 0x56, 0x78, 0x9a, 0xbc } },
    { 0xf1ae5991, 0xf36a, 0x84a4, { 0xee, 0x9f, 0x23, 0x4b, 0x37, 0xfb, 0xbe, 0x69 } },
};

bool uuid_is_in_blacklist(const TEE_UUID *uuid)
{
    if (uuid == NULL) {
        tloge("uuid is null\n");
        return false;
    }

    uint32_t count = sizeof(g_ta_blacklist) / sizeof(g_ta_blacklist[0]);

    for (uint32_t i = 0; i < count; i++) {
        if (TEE_MemCompare(uuid, &g_ta_blacklist[i], sizeof(TEE_UUID)) == 0) {
            tloge("uuid is in the blacklist, can not be load!");
            return true;
        }
    }

    return false;
}
#else
bool uuid_is_in_blacklist(const TEE_UUID *uuid)
{
    (void)uuid;
    return false;
}
#endif /* DEF_ENG */
